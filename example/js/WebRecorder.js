var WebRecorder=function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t),r.d(t,"WebRecorder",(function(){return u})),r.d(t,"Record",(function(){return o}));var o=function(){function e(e,t,r,o){this.type=e,this.mimeType=t,this.blob=r,this.url=o}return e.prototype.revokeObjectURL=function(){this.url?window.URL.revokeObjectURL(this.url):console.warn("Record::url not found.")},e}(),n=function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(e){i(e)}}function u(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}a((o=o.apply(e,t||[])).next())}))},i=function(e,t){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},s=["video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm"],u=function(){function e(e){this.recordedBlobs=[],this.isRecording=!1,this.options=this._validateOptions(e)}return e.prototype._validateOptions=function(e){var t=this._getDefaultOptions();return e&&"audio"in e&&(t.audio=e.audio),e&&"video"in e&&(t.video=e.video),e&&"stream"in e&&(t.stream=e.stream),e&&"constraints"in e&&(t.constraints=e.constraints),t},e.prototype._getDefaultOptions=function(){return{audio:!0,video:!0,constraints:{audio:{echoCancellation:{exact:!0}},video:{width:1280,height:720}}}},e.prototype.isRecordingSupported=function(){throw new Error("Method not implemented.")},e.prototype.getSupportedMimeTypes=function(){return this._getSupportedMimeType()},e.prototype.start=function(){return n(this,void 0,void 0,(function(){var e,t,r;return i(this,(function(o){switch(o.label){case 0:if(this._isRecordingInProgress())throw new Error("ERR_RECORDING_IN_PROGRESS");return this.isStreamAvailable()?[3,2]:(e=this.options,[4,this._getUserMedia()]);case 1:e.stream=o.sent(),o.label=2;case 2:if(0==(t=this._getSupportedMimeType()).length)throw new Error("ERR_MIMETYPE_NOT_SUPPORTED");return r=t[0],this.initAndStart(r),[2,Promise.resolve(this.options.stream)]}}))}))},e.prototype._isRecordingInProgress=function(){return this.isRecording},e.prototype.stop=function(){console.log(this.recorder),this.recorder&&"recording"===this.recorder.state?this.recorder.stop():console.warn("Recording not started yet.")},e.prototype.initAndStart=function(e){this.options.stream&&(this.recorder=new MediaRecorder(this.options.stream,{mimeType:e}),this.recorder.ondataavailable=this.handleDataAvailableEvent.bind(this),this.recorder.onresume=this.handleResumeEvent.bind(this),this.recorder.onpause=this.handlePauseEvent.bind(this),this.recorder.onerror=this.handleErrorEvent.bind(this),this.recorder.onstop=this.handleStopEvent.bind(this),this.recorder.start(),this.isRecording=!0)},e.prototype.handleErrorEvent=function(e){this.onerror&&this.onerror(e),this.cleanup()},e.prototype.handleStopEvent=function(e){if(this.recorder){var t=new Blob(this.recordedBlobs,{type:"video/webm"}),r=new o("video/webm",this.recorder.mimeType,t,window.URL.createObjectURL(t));this.onstop&&this.onstop(r)}this.cleanup()},e.prototype.cleanup=function(){this.isRecording=!1,this.recordedBlobs=[],this.recorder=void 0},e.prototype.handlePauseEvent=function(e){},e.prototype.handleResumeEvent=function(e){},e.prototype.handleDataAvailableEvent=function(e){console.log(e),e.data&&e.data.size>0&&this.recordedBlobs.push(e.data)},e.prototype.isStreamAvailable=function(){return null!=this.options.stream||null!=this.options.stream},e.prototype.getSupportedMimeType=function(){return this._getSupportedMimeType()},e.prototype._getSupportedMimeType=function(){var e=this;return s.filter((function(t){return e._isMimeTypeSupported(t)}))},e.prototype._isMimeTypeSupported=function(e){return MediaRecorder.isTypeSupported(e)},e.prototype._getUserMedia=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){return[2,navigator.mediaDevices.getUserMedia(this.options.constraints)]}))}))},e}()}]);